var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},a,i,r,s;return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(t){return function(e){return c([t,e])}}function c(s){if(a)throw new TypeError("Generator is already executing.");while(n)try{if(a=1,i&&(r=s[0]&2?i["return"]:s[0]?i["throw"]||((r=i["return"])&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;if(i=0,r)s=[s[0]&2,r.value];switch(s[0]){case 0:case 1:r=s;break;case 4:n.label++;return{value:s[1],done:false};case 5:n.label++;i=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(r=n.trys,r=r.length>0&&r[r.length-1])&&(s[0]===6||s[0]===2)){n=0;continue}if(s[0]===3&&(!r||s[1]>r[0]&&s[1]<r[3])){n.label=s[1];break}if(s[0]===6&&n.label<r[1]){n.label=r[1];r=s;break}if(r&&n.label<r[2]){n.label=r[2];n.ops.push(s);break}if(r[2])n.ops.pop();n.trys.pop();continue}s=e.call(t,n)}catch(t){s=[6,t];i=0}finally{a=r=0}if(s[0]&5)throw s[1];return{value:s[0]?s[1]:void 0,done:true}}};import{r as registerInstance,c as createEvent,h,g as getElement,H as Host}from"./index-8809c729.js";var viewCss="taro-movable-view-core{display:inline-block;position:absolute;left:0;top:0;width:10px;height:10px}";var __awaiter=undefined&&undefined.__awaiter||function(t,e,n,a){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function s(t){try{c(a.next(t))}catch(t){r(t)}}function o(t){try{c(a["throw"](t))}catch(t){r(t)}}function c(t){t.done?n(t.value):i(t.value).then(s,o)}c((a=a.apply(t,e||[])).next())}))};var MovableView=function(){function t(t){var e=this;registerInstance(this,t);this.onChange=createEvent(this,"change",7);this.onScale=createEvent(this,"scale",7);this.onHTouchMove=createEvent(this,"htouchmove",7);this.onVTouchMove=createEvent(this,"vtouchmove",7);this.x=0;this.y=0;this.direction="none";this.outOfBounds=false;this.inertia=false;this.friction=2;this.damping=20;this.disabled=false;this.scale=false;this.scaleMin=.5;this.scaleMax=10;this.scaleValue=1;this.animation=true;this.translateX=0;this.translateY=0;this.origin={x:0,y:0};this.area={width:0,height:0};this.originScale=1;this.currentScale=1;this.width=0;this.height=0;this.minX=0;this.minY=0;this.maxX=0;this.maxY=0;this.baseX=0;this.baseY=0;this.offset={x:0,y:0};this.scaleOffset={x:0,y:0};this.getLimitXY=function(t,n){var a=false;t>e.maxX?(t=e.maxX,a=true):t<e.minX&&(t=e.minX,a=true);n>e.maxY?(n=e.maxY,a=true):n<e.minY&&(n=e.minY,a=true);return{x:t,y:n,outOfBounds:a}};this.animationTo=function(t,n,a,i,r,s,o){if(e.animation){e.setTransform(t,n,a,i,r,s);o===null||o===void 0?void 0:o()}else{e.setTransform(t,n,a,i,r,s)}};this.setTransform=function(t,n,a,i,r,s){t=Number(t.toFixed(1));n=Number(n.toFixed(1));a=Number((a!==null&&a!==void 0?a:e.currentScale).toFixed(3));if(!e.outOfBounds){var o=e.getLimitXY(t,n);t=o.x;n=o.y}var c=function(t,e){return+((1e3*t-1e3*e)/1e3).toFixed(1)};var l=c(t,e.scaleOffset.x);var u=c(n,e.scaleOffset.y);if(e.translateX!==t||e.translateY!==n){!r&&e.onChange.emit({x:l,y:u,source:i})}if(a!==e.currentScale){s&&e.onScale.emit({scale:a,x:l,y:u})}var h="translateX("+t+"px) translateY("+n+"px) translateZ(0px) scale("+a+")";e.element.style.transform=h;e.element.style.webkitTransform=h;e.translateX=t;e.translateY=n;e.currentScale=a};this.updateOffset=function(){var t=function(e,n){if(e===n||!e.offsetParent){return{left:0,top:0}}var a=t(e.offsetParent,n);return{left:e.offsetLeft+a.left,top:e.offsetTop+a.top}};if(!e.parent){return}var n=t(e.element,e.parent);e.offset.x=n.left;e.offset.y=n.top};this.updateScaleOffset=function(t){if(t===void 0){t=e.currentScale}var n=e.element.getBoundingClientRect();e.height=n.height/e.currentScale;e.width=n.width/e.currentScale;e.scaleOffset.x=(e.width*t-e.width)/2;e.scaleOffset.y=(e.height*t-e.height)/2};this.updateBoundary=function(){var t=0-e.offset.x+e.scaleOffset.x;var n=e.area.width-e.width-e.offset.x-e.scaleOffset.x;e.minX=Math.min(t,n);e.maxX=Math.max(t,n);var a=0-e.offset.y+e.scaleOffset.y;var i=e.area.height-e.height-e.offset.y-e.scaleOffset.y;e.minY=Math.min(a,i);e.maxY=Math.max(a,i)};this.updateScale=function(t,n,a){if(!e.scale){return}var i=e.adjustScale(t);e.updateScaleOffset(i);e.updateBoundary();var r=e.getLimitXY(e.translateX,e.translateY),s=r.x,o=r.y;if(n){e.animationTo(s,o,i,"",true,true,a)}else if(!e.updating){e.updating=true;requestAnimationFrame((function(){e.setTransform(s,o,i,"",true,true);e.updating=false}))}};this.setOriginScale=function(t){e.originScale=t};this.adjustScale=function(t){return Math.min(10,e.scaleMax,Math.max(.5,e.scaleMin,t))};this.handleTouchStart=function(t){var n=t.touches;if(e.disabled||n.length>1||!e.element){return}var a=n[0];e.touching=true;e.firstMoveFireEvent=false;e.origin.x=a.screenX;e.origin.y=a.screenY;e.baseX=e.translateX;e.baseY=e.translateY;e.element.style.willChange="transform"};this.handleTouchMove=function(t){var n=t.touches;if(e.disabled||!e.element||e.scaling||!e.touching||n.length>1){return}t.preventDefault();var a=n[0];var i=a.screenX-e.origin.x;var r=a.screenY-e.origin.y;e.setTransform(e.xMove?i+e.baseX:0,e.yMove?r+e.baseY:0);if(!e.firstMoveFireEvent){e.firstMoveFireEvent=true;var s=Math.abs(i)>Math.abs(r)?e.onHTouchMove:e.onVTouchMove;s.emit({originalEvent:t,bubbles:false,capturePhase:false,composed:true,extraFields:{touches:t.touches||{},changedTouches:t.changedTouches||{}}})}};this.handleTouchEnd=function(t){var n=t.changedTouches[0];if(e.disabled||!e.touching||!n){return}e.touching=false;var a=n.screenX-e.origin.x;var i=n.screenY-e.origin.y;e.setTransform(e.xMove?a+e.baseX:0,e.yMove?i+e.baseY:0)}}t.prototype.watchX=function(t){this.setTransform(parseFloat(""+(t||0)),this.translateY)};t.prototype.watchY=function(t){this.setTransform(this.translateX,parseFloat(""+(t||0)))};t.prototype.watchScaleMinOrMax=function(){if(!this.scale)return false;this.updateScale(this.currentScale,true);this.setOriginScale(this.currentScale)};t.prototype.watchScaleValue=function(t){if(!this.scale){return false}this.updateScale(t,true);this.setOriginScale(t);return t};t.prototype.setParent=function(t){var e=t.element,n=t.area;return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(a){t=this.scale?this.scaleValue:1;this.area=n;this.parent=e;this.updateOffset();this.updateScaleOffset(t);this.updateBoundary();this.setTransform(Number(this.x)+this.scaleOffset.x,Number(this.y)+this.scaleOffset.y,t,"",true);this.setOriginScale(t);return[2]}))}))};t.prototype.endScale=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.scaling=false;this.setOriginScale(this.currentScale);return[2]}))}))};t.prototype.setScale=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(!this.scale){return[2]}this.scaling=true;this.updateScale(t*this.originScale);return[2]}))}))};t.prototype.connectedCallback=function(){var t=this;this.observer=new MutationObserver((function(e){e.forEach((function(e){var n=e.attributeName;if(n&&["class","style"].includes(n)){var a=e.oldValue;var i=e.target.getAttribute(n);if(a===i){return}var r=function(t){return t===null||t===void 0?void 0:t.split(";").filter((function(t){return!["transform","will-change"].find((function(e){return t.trim().startsWith(e)}))})).join(";")};if(n==="style"&&r(i)===r(a)){return}t.updateOffset();t.updateScaleOffset();t.updateBoundary();t.setTransform(t.translateX,t.translateY)}}))}));this.observer.observe(this.element,{attributes:true,attributeOldValue:true})};t.prototype.disconnectedCallback=function(){var t;(t=this.observer)===null||t===void 0?void 0:t.disconnect()};t.prototype.componentDidLoad=function(){this.element.style.transformOrigin="center";this.xMove=["horizontal","all"].includes(this.direction);this.yMove=["vertical","all"].includes(this.direction);if(this.friction<=0){this.friction=2}if(this.x||this.y){var t=parseFloat(""+(this.x||0));var e=parseFloat(""+(this.y||0));this.setTransform(t,e)}};t.prototype.render=function(){return h(Host,{onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd})};Object.defineProperty(t.prototype,"element",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{x:["watchX"],y:["watchY"],scaleMin:["watchScaleMinOrMax"],scaleMax:["watchScaleMinOrMax"],scaleValue:["watchScaleValue"]}},enumerable:false,configurable:true});return t}();MovableView.style=viewCss;export{MovableView as taro_movable_view_core};