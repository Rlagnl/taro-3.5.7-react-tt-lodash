import{r as registerInstance,h,g as getElement,H as Host}from"./index-8809c729.js";var areaCss="taro-movable-area-core{display:block;height:10px;width:10px;position:relative}";var MovableArea=function(){function e(e){var t=this;registerInstance(this,e);this.views=[];this.scaleLength=0;this.viewsChanged=function(){t.views=[];var e=t.element.querySelectorAll("taro-movable-view-core");Array.from(e).forEach((function(e){t.views.push(e)}));t.updateArea()};this.handleTouchStart=function(e){var a=e.touches;if(!a||a.length<=1){return}var n={width:a[1].pageX-a[0].pageX,height:a[1].pageY-a[0].pageY};t.scaleLength=Math.sqrt(n.width*n.width+n.height*n.height);if(t.scaleArea){return}var r=function(e,t){var a=function(e,t){if(!(e=e.parentNode)){return false}return(!(e instanceof HTMLElement)||e!==document.body)&&(e===t||e===t.element||e.element===t||a(e,t))};for(var n=0;n<t.length;n++){var r=t[n];if(e===r["element"]||a(e,r)){return r}}};var i=r(a[0].target,t.views);var o=r(a[1].target,t.views);t.scaleTarget=i&&i===o?i:undefined};this.handleTouchMove=function(e){var a=e.touches;if(!a||a.length<=1){return}e.preventDefault();var n={width:a[1].pageX-a[0].pageX,height:a[1].pageY-a[0].pageY};if(t.scaleLength>0){t.updateScale(Math.sqrt(n.width*n.width+n.height*n.height)/t.scaleLength)}};this.handleTouchEnd=function(e){var a,n;if(e.touches&&e.touches.length||!e.changedTouches){return}t.scaleLength=0;if(t.scaleArea){t.views.forEach((function(e){var t;(t=e["endScale"])===null||t===void 0?void 0:t.call(e)}))}else{(n=(a=t.scaleTarget)===null||a===void 0?void 0:a["endScale"])===null||n===void 0?void 0:n.call(a)}t.scaleTarget=undefined};this.updateScale=function(e){var a,n;if(!e||e===1){return}if(t.scaleArea){t.views.forEach((function(t){var a;(a=t["setScale"])===null||a===void 0?void 0:a.call(t,e)}))}else{(n=(a=t.scaleTarget)===null||a===void 0?void 0:a["setScale"])===null||n===void 0?void 0:n.call(a,e)}};this.updateArea=function(){var e=window.getComputedStyle(t.element);var a=t.element.getBoundingClientRect();var n=["Left","Right"].map((function(t){return parseFloat(e["border"+t+"Width"])+parseFloat(e["padding"+t])}));var r=["Top","Bottom"].map((function(t){return parseFloat(e["border"+t+"Width"])+parseFloat(e["padding"+t])}));t.views.forEach((function(e){var i;(i=e["setParent"])===null||i===void 0?void 0:i.call(e,{element:t.element,area:{height:a.height-r[0]-r[1],width:a.width-n[0]-n[1]}})}))}}e.prototype.connectedCallback=function(){var e=this;this.observer=new MutationObserver((function(t){t.forEach((function(t){var a,n;if(t.attributeName==="class"||t.attributeName==="style"){var r=e.element.offsetWidth;var i=e.element.offsetHeight;if(r!==((a=e.offset)===null||a===void 0?void 0:a.width)||i!==((n=e.offset)===null||n===void 0?void 0:n.height)){e.updateArea()}e.offset={width:r,height:i}}}))}));this.observer.observe(this.element,{attributes:true})};e.prototype.disconnectedCallback=function(){var e;(e=this.observer)===null||e===void 0?void 0:e.disconnect()};e.prototype.componentDidLoad=function(){this.viewsChanged()};e.prototype.render=function(){return h(Host,{onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd})};Object.defineProperty(e.prototype,"element",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();MovableArea.style=areaCss;export{MovableArea as taro_movable_area_core};